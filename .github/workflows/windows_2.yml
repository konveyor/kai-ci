name: Windows Nightly Run

on: [push]

jobs:
  clone_repo:
    runs-on: ubuntu-latest # The action will run on a Linux runner first
    
    steps:
    - name: Check out the repository
      uses: actions/checkout@v3
    
    - name: Set up SSH key for authentication
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.EC2_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
        chmod 600 ~/.ssh/id_rsa
        ssh-keyscan -H ec2-52-90-29-139.compute-1.amazonaws.com >> ~/.ssh/known_hosts
    
    - name: Clone repository on EC2 Windows instance
      run: |
        ssh -o StrictHostKeyChecking=no -i ~/.ssh/id_rsa ${EC2_USER}@${EC2_HOST} 'powershell -Command "git clone https://github.com/konveyor/kai-ci.git C:\\Users\\nonadmin\\kai-ci"'
      env:
        EC2_USER: nonadmin
        EC2_HOST: ec2-52-90-29-139.compute-1.amazonaws.com
